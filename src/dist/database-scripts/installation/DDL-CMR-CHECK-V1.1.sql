---------------------------------------------------------
-- Export file for user O_LDS_META                     --
-- Created by Andrei.Popovici on 8/19/2015, 2:13:27 PM --
---------------------------------------------------------

spool cmr-check-ddl.log

prompt
prompt Creating table CMT_CHECK_DEFINITION
prompt ===================================
prompt
create table CMT_CHECK_DEFINITION
(
  CHK_ID                  NUMBER(18) not null,
  CHK_NAME                VARCHAR2(50) not null,
  CHK_DESCRIPTION         VARCHAR2(4000),
  CHK_AREA                VARCHAR2(30) not null,
  CHK_GROUP               VARCHAR2(30),
  CHK_SUBGROUP            VARCHAR2(30),
  CHK_EXECUTION_FREQUENCY VARCHAR2(30) not null,
  INSERT_TIME             TIMESTAMP(6) default sysdate not null,
  UPDATE_TIME             TIMESTAMP(6) default sysdate not null,
  LAST_USER               VARCHAR2(100) default 'SYSTEM' not null,
  CHK_CODE                VARCHAR2(50) not null,
  CHK_SQL                 CLOB not null
)
;
comment on table CMT_CHECK_DEFINITION
  is 'DQI Deifnitions';
comment on column CMT_CHECK_DEFINITION.CHK_ID
  is 'The autogenerated ID of the CHECK DEFINIITON';
comment on column CMT_CHECK_DEFINITION.CHK_NAME
  is 'The name of the CHECK';
comment on column CMT_CHECK_DEFINITION.CHK_DESCRIPTION
  is 'A descritption of what the CHECK does: what it checks for, amybe what are the implications';
comment on column CMT_CHECK_DEFINITION.CHK_AREA
  is 'A general area of the check. To be defined';
comment on column CMT_CHECK_DEFINITION.CHK_GROUP
  is 'A subdivision of the area. Useful for categorizing checks. To be defined';
comment on column CMT_CHECK_DEFINITION.CHK_SUBGROUP
  is 'A sbdivision of the group. Alos useful for categorizing checks. To be defined';
comment on column CMT_CHECK_DEFINITION.CHK_EXECUTION_FREQUENCY
  is 'standard list of values for the execution frequency. List to be defined';
comment on column CMT_CHECK_DEFINITION.INSERT_TIME
  is 'The date and time when the definition was created';
comment on column CMT_CHECK_DEFINITION.UPDATE_TIME
  is 'The date and time when the defintion was last updated';
comment on column CMT_CHECK_DEFINITION.LAST_USER
  is 'The user that last that touched the record';
comment on column CMT_CHECK_DEFINITION.CHK_CODE
  is 'A unique code of the CHK Definition';
comment on column CMT_CHECK_DEFINITION.CHK_SQL
  is 'The SQL Query which must be run';
alter table CMT_CHECK_DEFINITION
  add constraint PK_DQI_DEF primary key (CHK_ID);

prompt
prompt Creating table CMT_CHECK_REQUEST
prompt ================================
prompt
create table CMT_CHECK_REQUEST
(
  RQ_ID             NUMBER(18) not null,
  RQ_DESC           VARCHAR2(400),
  RQ_REQUESTER_CODE VARCHAR2(30) not null,
  RQ_METHOD         VARCHAR2(30) not null,
  INSERT_TIME       TIMESTAMP(6) default sysdate not null,
  UPDATE_TIME       TIMESTAMP(6) default sysdate not null,
  LAST_USER         VARCHAR2(1000) default 'SYSTEM' not null
)
;
comment on column CMT_CHECK_REQUEST.RQ_ID
  is 'Unique udentifier of the request';
comment on column CMT_CHECK_REQUEST.RQ_DESC
  is 'Description of the Request';
comment on column CMT_CHECK_REQUEST.RQ_REQUESTER_CODE
  is 'Code to identify the Requester';
comment on column CMT_CHECK_REQUEST.RQ_METHOD
  is 'Method od the request. List of Values TBD';
comment on column CMT_CHECK_REQUEST.INSERT_TIME
  is 'The time when the record was created';
comment on column CMT_CHECK_REQUEST.UPDATE_TIME
  is 'The time when the record was updated';
comment on column CMT_CHECK_REQUEST.LAST_USER
  is 'The user that last modified the record';
alter table CMT_CHECK_REQUEST
  add constraint PK_CHK_REQUEST primary key (RQ_ID);

prompt
prompt Creating table CMT_CHECK_EXECUTION
prompt ==================================
prompt
create table CMT_CHECK_EXECUTION
(
  EX_ID                        NUMBER(18) not null,
  ORIG_CHK_ID                  NUMBER(18),
  ORIG_CHK_NAME                VARCHAR2(50) not null,
  ORIG_CHK_DESCRIPTION         VARCHAR2(4000) not null,
  ORIG_CHK_AREA                VARCHAR2(30) not null,
  ORIG_CHK_GROUP               VARCHAR2(30),
  ORIG_CHK_SUBGROUP            VARCHAR2(30),
  ORIG_CHK_EXECUTION_FREQUENCY VARCHAR2(30) not null,
  ORIG_CHK_CODE                VARCHAR2(50) not null,
  ORIG_CHK_SQL                 CLOB not null,
  INSERT_TIME                  TIMESTAMP(6) default sysdate not null,
  UPDATE_TIME                  TIMESTAMP(6) default sysdate not null,
  LAST_USER                    VARCHAR2(100) default 'SYSTEM' not null,
  EX_STATUS                    VARCHAR2(30) not null,
  EX_STATUS_DETAILS            VARCHAR2(4000),
  EX_START                     DATE,
  EX_END                       DATE,
  EX_RQ_ID                     NUMBER(18) not null
)
;
comment on table CMT_CHECK_EXECUTION
  is 'The table whch holds the execution statuses for the checks. It must be sinchronized with the CHK_DEFINTIONTABLE';
comment on column CMT_CHECK_EXECUTION.EX_ID
  is 'Auto generated number as unique id for the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_ID
  is 'The key of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_NAME
  is 'The name of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_DESCRIPTION
  is 'The description of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_AREA
  is 'The area of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_GROUP
  is 'The group of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_SUBGROUP
  is 'The subgroup of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_EXECUTION_FREQUENCY
  is 'The execution_frequency of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_CODE
  is 'The code of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.ORIG_CHK_SQL
  is 'The sql of the CHECK defintion that was executed, as it was at the moment of the execution';
comment on column CMT_CHECK_EXECUTION.INSERT_TIME
  is 'Technical column to keep the creattion time for the record';
comment on column CMT_CHECK_EXECUTION.UPDATE_TIME
  is 'Technical column to keep the last update time for the record';
comment on column CMT_CHECK_EXECUTION.LAST_USER
  is 'Technical column to keep the last user for the record';
comment on column CMT_CHECK_EXECUTION.EX_STATUS
  is 'The status of the execution. Possible values: INP (In Progress), SUCCESS,ERROR';
comment on column CMT_CHECK_EXECUTION.EX_STATUS_DETAILS
  is 'Additonal Details about the execution of the check. Useful to give error hints or waning messages';
comment on column CMT_CHECK_EXECUTION.EX_START
  is 'The start time of the execution';
comment on column CMT_CHECK_EXECUTION.EX_END
  is 'The end time of the execution';
comment on column CMT_CHECK_EXECUTION.EX_RQ_ID
  is 'The key of the Request for which this execution is created';
alter table CMT_CHECK_EXECUTION
  add constraint PK_CHK_EXEC primary key (EX_ID);
alter table CMT_CHECK_EXECUTION
  add constraint FK_CHK_EXEC_DEF foreign key (ORIG_CHK_ID)
  references CMT_CHECK_DEFINITION (CHK_ID) on delete set null;
alter table CMT_CHECK_EXECUTION
  add constraint FK_CHK_EXEC_REQ foreign key (EX_RQ_ID)
  references CMT_CHECK_REQUEST (RQ_ID) on delete cascade;

prompt
prompt Creating table CMT_CHECK_ISSUE
prompt ==============================
prompt
create table CMT_CHECK_ISSUE
(
  ISS_ID          NUMBER(18) not null,
  ISS_EX_ID       NUMBER(18) not null,
  ISS_DESCRIPTION VARCHAR2(4000) not null,
  ISS_TYPE        VARCHAR2(30) default 'SIMPLE' not null,
  INSERT_TIME     TIMESTAMP(6) default sysdate not null,
  UPDATE_TIME     TIMESTAMP(6) default sysdate not null,
  LAST_USER       VARCHAR2(100) default 'SYSTEM' not null,
  ISS_RQ_ID       NUMBER(18) not null
)
;
comment on table CMT_CHECK_ISSUE
  is 'Issue generated as a result of  a check execution';
comment on column CMT_CHECK_ISSUE.ISS_ID
  is 'Generated Id of the issue';
comment on column CMT_CHECK_ISSUE.ISS_EX_ID
  is 'Id of the execution that resulted with the creation of this issue';
comment on column CMT_CHECK_ISSUE.ISS_DESCRIPTION
  is 'Description of the issue';
comment on column CMT_CHECK_ISSUE.ISS_TYPE
  is 'Type of the issue.';
comment on column CMT_CHECK_ISSUE.INSERT_TIME
  is 'Timestamp when the record was created';
comment on column CMT_CHECK_ISSUE.UPDATE_TIME
  is 'Timestamp when the record was last updated';
comment on column CMT_CHECK_ISSUE.LAST_USER
  is 'The user who last updated the Issue';
comment on column CMT_CHECK_ISSUE.ISS_RQ_ID
  is 'The key of the request under which this issue is created';
alter table CMT_CHECK_ISSUE
  add constraint PK_CMT_CHK_ISS primary key (ISS_ID);
alter table CMT_CHECK_ISSUE
  add constraint FK_CMT_CHK_ISS_TO_EX foreign key (ISS_EX_ID)
  references CMT_CHECK_EXECUTION (EX_ID) on delete cascade;

prompt
prompt Creating table CMT_CHECK_PARAMETER
prompt ==================================
prompt
create table CMT_CHECK_PARAMETER
(
  PRM_ID           NUMBER(18) not null,
  PRM_TYPE         VARCHAR2(30) not null,
  PRM_KEY          VARCHAR2(100) not null,
  PRM_VALUE        VARCHAR2(4000) not null,
  PRM_REFRESH_FLAG CHAR(1) not null,
  INSERT_TIME      TIMESTAMP(6) default sysdate not null,
  UPDATE_TIME      TIMESTAMP(6) default sysdate not null,
  LAST_USER        VARCHAR2(100) default 'SYSTEM' not null
)
;
comment on table CMT_CHECK_PARAMETER
  is 'Parameters that can be reuesed in the check definition';
comment on column CMT_CHECK_PARAMETER.PRM_ID
  is 'The primary key for a parameter';
comment on column CMT_CHECK_PARAMETER.PRM_TYPE
  is 'The type of the parameters: FIXED_VALUE, SQL,JAVA';
comment on column CMT_CHECK_PARAMETER.PRM_KEY
  is 'The key, the name of the parameter: CURRENT_VERSION';
comment on column CMT_CHECK_PARAMETER.PRM_VALUE
  is 'The value of teh parameter. Depends on the type.';
comment on column CMT_CHECK_PARAMETER.PRM_REFRESH_FLAG
  is 'Info about the refresh policy: Y - needs refresh every time it gets read,  N - does not need refresh';
comment on column CMT_CHECK_PARAMETER.INSERT_TIME
  is 'The date and time when the parameter was created';
comment on column CMT_CHECK_PARAMETER.UPDATE_TIME
  is 'The date and time when the parameter was updated';
comment on column CMT_CHECK_PARAMETER.LAST_USER
  is 'The user that last that touched the record';
alter table CMT_CHECK_PARAMETER
  add constraint PK_CHK_PRM_ID primary key (PRM_ID)
  disable;
alter table CMT_CHECK_PARAMETER
  add constraint UK_CHK_PRM_KEY unique (PRM_KEY)
  disable;

prompt
prompt Creating sequence SEQ_CHECKS
prompt ============================
prompt
create sequence SEQ_CHECKS
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;


spool off
